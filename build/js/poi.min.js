function lcz(){var _this=this;this.geci_object,this.geci_lines,this.upkp,this.classV1,this.classV2,this.initTop,this.center,this.empty,this.isDropgeci,this.width,this.height,this.align,this.oneline,this.luminous,this.change,this.staue=!0,this.tag={},this.mould='<ul style="height: 300px;list-style: none;position: relative;line-height: 28px;padding: 0 15px;overflow-y: hidden;display:none;"></ul>',this.getgeci="Value";var errmsg="程序发生异常，无法继续了！";this.toTimer=function(e){var t,n;return t=Math.floor(e/60),t=isNaN(t)?"--":t>=10?t:"0"+t,n=Math.floor(e%60),n=isNaN(n)?"--":n>=10?n:"0"+n,t+":"+n},this.addgeci=function(e,t,n){var r=document.createElement("li");r.innerHTML=t?t:"",r.className=e?e:"",r.lang=n?n:"",this.geci_object.appendChild(r),this.geci_lines.push(r)},this.getgeciByValue=function(e){le=this.geci_lines.length,e="^"+e+".*";for(var t=0;t<le;t++){if(this.geci_lines[t].lang.search(e)==0){return this.geci_lines[t]}}return null},this.getgeciByValueInd=function(e){le=this.geci_lines.length-1;for(var t=le;t>=0;t--){p=this.geci_lines[t].lang;if(p&&p<e){return this.geci_lines[t]}}return null},this.setClassName=function(e,t){e&&(e.className=t)},this.upTop=function(e){var t=e.offsetTop,n=this.geci_object.scrollTop,r=t-this.center;this.myf(this.geci_object,n,r)},this.remove=function(){if(this.geci_lines!=null){for(var e=0;e<this.geci_lines.length;e++){this.geci_object.removeChild(this.geci_lines[e])}}this.geci_lines=new Array,!this.empty&&this.empty!=0&&alert("empty 属性有误! 该值必须>=零")},this.load=function(json,fun){gecis=json.gecis,end=json[this.tag.end];with(this){remove(),_addgeci(json[this.tag.sname]),_addgeci(json[this.tag.cname]),_addgeci(json[this.tag.qname]),_addgeci(json[this.tag.bname]),_addgeci(json[this.tag.sgname]),_addgeci(json[this.tag.special]),_addgeci(json[this.tag.kname])}if(gecis){for(var index in gecis){this.addgeci(this.classV1,gecis[index].name,gecis[index].time)}}end&&(end.time?this.addgeci(this.classV1,end.end,end.time):this.addgeci(this.classV1,end)),typeof fun=="function"&&fun.call(null,null)},this._addgeci=function(e){e&&(e.time?this.addgeci(this.classV1,e.name,e.time):this.addgeci(this.classV1,e))},this.Read=function(e,t){if(t!=null&&typeof t=="function"){return t.call(this,e)}var n={};n.gecis=new Array;var r=e.split("["),i=r.length;for(var s=0;s<i;s++){var o=r[s],u=o.split("]");if(u.length==2){if(u[0].search("^[0-9]{2}:[0-9]{2}.[0-9]{1,3}$")<0){title=u[0].split(":"),n=tagswitch(title,n)}else{var a={time:u[0],name:u[1]};n.gecis.push(a)}}}return n},this.vls1=function(e){var n={};n.gecis=new Array;var r=e.length,i=0,s=0,o=new Array;for(var u=0;u<r;u++){e[u]=="["&&u>8&&(e.slice(u-9,u-1)+"").search("^[0-9]{2}:[0-9]{2}.[0-9]{1,3}$")<0&&(o.push(e.substring(i,u)),i=u)}o.push(e.substring(i,r));var a={},f=[];for(var u=0;u<o.length;u++){var l=o[u],c=l.split("]");if(c.length===2){(c[0]+"").search("^\\[[0-9]{2}:[0-9]{2}.[0-9]{1,3}$")<0?(c[0]=c[0].slice(1),title=c[0].split(":"),n=tagswitch(title,n)):(h=c[0].slice(1)+"",a[h]=c[1],f.push(h))}else{if(c.length>2){var h,e;e=c[c.length-1];for(var p in c){c[p].search("^\\[[0-9]{2}:[0-9]{2}.[0-9]{1,3}$")==0&&(h=c[p].slice(1)+"",a[h]=e,f.push(h))}}}}f=f.sort();for(var p in f){t=f[p];var d={time:t,name:a[t]};n.gecis.push(d)}return n};var tagswitch=function(e,t){e.length===2&&(tp=e[1]),tag=_this.tag;switch(e[0]){case tag.sname:t[tag.sname]=tp;break;case tag.cname:t[tag.cname]=tp;break;case tag.qname:t[tag.qname]=tp;break;case tag.bname:t[tag.bname]=tp;break;case tag.sgname:t[tag.sgname]=tp;break;case tag.special:t[tag.special]=tp;break;case tag.kname:t[tag.kname]=tp;break;case tag.end:t[tag.end]=tp}return t};this.myf_Init=function(){this.geci_object.innerHTML=this.mould,asc=this.geci_object=this.geci_object.firstChild,asc.style.width=this.width,asc.style.height=this.height,asc.style.textAlign=this.align,this.oneline?(this.empty=0,this.center=5):(this.empty=5,this.center=this.geci_object.style.height/2|80),this.isDropgeci&&this.logon(!1)},this.setoccupy=function(e,t){e.style.display="block",this.setClassName(e,this.classV2),this.upTop(e),this.upkp&&this.unoccupy(this.upkp),this.upkp=e,t&&t(e)},this.unoccupy=function(e,t){this.setClassName(e,this.classV1),this.oneline&&(e.style.display="none"),t&&t(e)},this.torun=function(time){if(!this.staue){return !1}var time=this.toTimer(Math.round((time|event.srcElement.currentTime)*100)/100),line=eval("this.getgeciBy"+this.getgeci+"(time)");line&&this.upkp!=line&&this.setoccupy(line)},this.logon=function(e){if(window.FileReader){var t=this.geci_object;e&&(t=document.getElementById(e));function n(e){e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files;for(var n=0,r;r=t[n];n++){var i=new FileReader;i.onloadend=function(e){return function(e){img=e.target.result,img&&_this.load(_this.Read(img))}}(r),i.readAsText(r)}}function r(e){}function i(e){}function s(e){e.stopPropagation(),e.preventDefault()}t.addEventListener("dragenter",r,!1),t.addEventListener("dragover",s,!1),t.addEventListener("drop",n,!1),t.addEventListener("dragleave",i,!1),t.addEventListener("ondragend",i,!1)
}else{alert("你的浏览器不支持呢")}};var timer=null;this.myf=function(e,t,n){timer!=null&&clearTimeout(timer),this.isUpOrDown(e,t,n)},getUpValue=function(e,t){return t-e>100?e+=30:t-e>50?e+=10:t-e>20?e+=5:t-e>1&&e++,e},getDowmValue=function(e,t){return e-t>100?e-=30:e-t>50?e-=10:e-t>20?e-=5:e-t>1&&e--,e},this.isUpOrDown=function(e,t,n){t<n?this.toUp(e,t,n):this.toDown(e,t,n)},this.toUp=function(e,t,n){timer=setInterval(function(){t>=n&&(clearTimeout(timer),timer=null,e.scrollTop=n),e.scrollTop=t,t=getUpValue(t,n)},10)},this.toDown=function(e,t,n){timer=setInterval(function(){t<=n&&(clearTimeout(timer),timer=null,e.scrollTop=n),e.scrollTop=t,t=getDowmValue(t,n)},30)},this.destory=function(){}}geci={msg:{ms1:"元素位置没有给出！ error : 103",ms2:"请给出歌词的链接地址，或文本内容！ error : 105"},tag:{sname:"ti",cname:"cl",qname:"cs",bname:"ps",sgname:"ar",special:"al",kname:"by",end:"end"},build:function(d,e){var f=new lcz;return f.tag=geci.tag,d.object?f.geci_object=document.getElementById(d.object):alert(geci.msg.ms1),f.initTop=d["initTop"]!=null?d.initTop:0,f.center=d["center"]!=null?d.center:0,f.empty=d["empty"]!=null?d.empty:0,f.isDropgeci=d["isDropgeci"]!=null?d.isDropgeci:!0,f.getgeci=d["seekMark"]!=null?d.seekMark:"Value",e&&(f.classV1=e["notoccupy"]!=null?e.notoccupy:"geci_moonlight",f.classV2=e["occupy"]!=null?e.occupy:"geci_attention",f.width=e["width"]!=null?e.width:"550px",f.height=e["height"]!=null?e.height:"200px",f.align=e["align"]!=null?e.align:"center",f.oneline=e["oneline"]!=null?e.oneline:!1),f.myf_Init(),geci.readgeci(f,d.readType,{url:d.geciUrl?d.geciUrl:null,text:d.geciText?d.geciText:null},function(){f.geci_object.scrollTop=f.initTop,f.oneline&&(f.geci_object.className+=" geci_hide"),d.syntony&&d.syntony(f)})&&d.open&&geci.open(f),d.media&&(mp=document.getElementById(d.media),window.attachEvent?mp.attachEvent("ontimeupdate",function(){f.torun()}):mp.addEventListener("timeupdate",function(){f.torun()},!1)),f},readgeci:function(i,e,h,j){var g="";if(h.text){g=h.text}else{if(!h.url){return alert(geci.msg.ms2),!1}xmlhttp=null,window.XMLHttpRequest?xmlhttp=new XMLHttpRequest:window.ActiveXObject&&(xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")),xmlhttp!=null&&(xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4){if(xmlhttp.status==200){return g=xmlhttp.responseText,g=g.replace(/<\/?.+?>/g,"").replace(/[\r\n]/g,""),i.load(i.Read(g,e),j),!0}$("#lrc_2 ul").append('<li style="color: #69d2e7;">暂无歌词</li>')}},xmlhttp.open("GET",h.url,!0),xmlhttp.send(null))}return i.load(i.Read(g,e),j),!0},open:function(b){b.geci_object&&(b.geci_object.style.display="block"),b.staue=!0},close:function(b){b.geci_object&&(b.geci_object.style.display="none"),b.staue=!1},suspend:function(b){b.geci_object&&(b.staue=!1)},destroy:function(b){geci.close(b),b.remove(b.geci_object)},setProgress:function(c,d){c.torun(d)}};(function(f){if(f(".music-search-json").length>0){for(var B=0;B<playlist.length;B++){var z=playlist[B],E=z.list,G=B;G++;f("#poi-search-music-list").append('<div id="list-music-song"><div class="try-listen"><a href="javascript:;" id="try-listen-play"><i class="poifont goplay">&#xe60c;</i></a></div><div class="list-song-cover"><div class="list-music-cover"><span class="song-cd-cover" style="background-image:url('+E.cover+');"></span><span class="song-cd-pan" style="background-image:url('+E.cd+');"></span></div></div><ul class="list-song-info"><li class="list-song-info-title"><i class="poifont">&#xe600;</i> '+E.title+" - "+E.artist+'</li><li class="list-song-info-link"><i class="poifont">&#xe601;</i> '+E.mp3+'</li><li class="list-song-info-down"><i class="poifont">&#xe601;</i> '+E.download+'</li><li class="list-song-info-mv"><i class="poifont">&#xe603;</i> MV功能正在施工...</li></ul></div>');f("#poi-playlist ul").append("<li>"+G+".&nbsp;&nbsp;"+E.artist+" - "+E.title+"</li>")}f("#try-listen-play i").each(function(c){f(this).on("click",function(){F(c);if(f(this).hasClass("goplay")){D();f("#try-listen-play i").html("&#xe60c;").eq(c).html("&#xe611;");f(this).html("&#xe611;").removeClass("goplay")}else{j();f(this).html("&#xe60c;").addClass("goplay")}})})}else{for(var B=0;B<playlist.length;B++){var z=playlist[B],E=z.list,G=B;G++;f("#poi-playlist ul").append("<li>"+G+".&nbsp;&nbsp;"+E.artist+" - "+E.title+"</li>")}var a=function(){var c=(boxsearch)?true:false;if(c){if(f("#poi-play-bar").hasClass("poi-c")){f("#poi-play-bar").removeClass("poi-c").addClass("poi-o").css({"width":"100%"});f("#open-poi-player i").html("&#xe607;")}if(f("#poi-music-list").hasClass("poi-music-list-c")){f("#poi-music-list").removeClass("poi-music-list-c").addClass("poi-music-list-o")}}};a()}f("body").append('<audio id="mp3" type="audio/mpeg">');var C=(mshuffle)?"true":"false";var s=localStorage.repeat||0,g=localStorage.shuffle=C,b=true,w=true;var k=new Date(),n=g==="true"?k.getTime()%playlist.length:0,y=false,H=f("#mp3")[0],r,d,e;var D=function(){u(0.2);H.play();f("#poi-play-bar .poiplay i").html("&#xe60d;").addClass("inplay");f(".czui").removeClass("czui-c").addClass("czui-o");
f("#poi-song-cover img").addClass("degs");r=setInterval(q,500);d=true};var j=function(){H.pause();f("#poi-play-bar .poiplay i").html("&#xe60c;").removeClass("inplay");f(".czui").removeClass("czui-o").addClass("czui-c");f("#poi-song-cover img").removeClass("degs");clearInterval(q);d=false};var v=function(J){var M=parseInt(J%60)<10?"0"+parseInt(J%60):parseInt(J%60),i=J/H.duration*100;var L=H.duration;var I;if(!L){I="加载中..."}else{var K=parseInt(L/60);var c=parseInt(L%60);K=K>=10?K:"0"+K;c=c>=10?c:"0"+c;I="0"+parseInt(J/60)+":"+M+"/"+K+":"+c}f("#poi-play-bar .poi-progress .poi-pace").css("width",i+"%");f("#poi-play-bar .poi-timer").html(I)};var m=function(){var c=this.seekable&&this.seekable.length?this.seekable.end(0):0;f("#poi-play-bar .poi-progress .poi-loaded").css("width",(100/(this.duration||1)*c)+"%")};var q=function(){v(H.currentTime)};f("#poi-play-bar .poi-progress .poi-sider").slider({step:0.1,slide:function(c,i){f(this).addClass("enable");v(H.duration*i.value/100);clearInterval(r)},stop:function(c,i){H.currentTime=H.duration*i.value/100;f(this).removeClass("enable");r=setInterval(q,500)}});var u=function(c){H.volume=localStorage.volume=c;f("#poi-play-bar .volume .pace").css("width",c*100+"%");f("#poi-play-bar .volume .slider a").css("left",c*100+"%")};var A=localStorage.volume||0.5;f("#poi-play-bar .volume .slider").slider({max:1,min:0,step:0.01,value:A,slide:function(c,i){u(i.value);f(this).addClass("enable");f("#poi-play-bar .mute").removeClass("enable")},stop:function(){f(this).removeClass("enable")}}).children("#poi-play-bar .pace").css("width",A*100+"%");f("#poi-play-bar .mute").click(function(){if(f(this).hasClass("enable")){u(f(this).data("volume"));f(this).removeClass("enable");f(this).addClass("fa-volume-up").removeClass("fa-volume-off")}else{f(this).data("volume",H.volume).addClass("enable");f(this).removeClass("fa-volume-up").addClass("fa-volume-off");u(0)}});var F=function(c){if(c<0){track=n=playlist.length-1}else{if(c>=playlist.length){track=n=0}else{track=c}}x(track)};var l=function(){var i=new Date(),c=n;n=i.getTime()%playlist.length;if(c==n){++n}F(n)};var h=function(){j();H.currentTime=0;e++;if(b==true){d=true}if(s==1){D()}else{if(g==="true"){l()}else{if(s==2){F(++n)}else{if(n<playlist.length){F(++n)}}}}};var o=function(){var c=(mautoplay)?true:false;if(w==c){D()}};var x=function(J){var c=playlist[J],K=c.list,I=(c.tags!=undefined)?" - "+c.tags:"",L=(c.album!=undefined)?c.album:"关于 “ "+c.search+" ” 共找到"+playlist.length+"首单曲";f("#poi-play-bar .poi-song-title").html("<span>"+K.title+'</span><span> - </span><span class="artist">'+K.artist+"</span>");f("#scripylrc p").html('<script>geci.build({object:"lrc_2",media:"mp3",geciUrl:"'+K.lrc+'",readType:"vls1",open:true},{oneline:false,height:"229px",width:"100%"});<\/script>');f(".poi-album-tiele").html(L);f(".poi-album-tags").html(I);f("#poi-song-cover").html('<img src="'+K.cover+'">');f("#poi-music-list li").removeClass("playing").eq(J).addClass("playing");f.getJSON(geturl+"get.php?id="+K.id,function(i){f("#mp3").attr("src",i.url);if(d==true){D()}H.volume=f("#poi-play-bar .mute").hasClass("enable")?0:1;H.addEventListener("progress",m,false);H.addEventListener("durationchange",m,false);H.addEventListener("canplay",o,false);H.addEventListener("ended",h,false)})};if(f(".music-json").length>0){x(n)}f("#poi-play-bar .poiplay").on("click",function(){if(f("#poi-play-bar .poiplay i").hasClass("inplay")){j()}else{D()}});f("#poi-play-bar .rewind").on("click",function(){if(g==="true"){l()}else{F(--n)}});f("#poi-play-bar .fastforward").on("click",function(){if(g==="true"){l()}else{F(++n)}});f("#poi-music-list li").each(function(c){var I=c;f(this).on("click",function(){F(I);D()})});if(g==="true"){f("#poi-play-bar .shuffle").addClass("enable")}if(s==1){f("#poi-play-bar .repeat").addClass("once")}else{if(s==2){f("#poi-play-bar .repeat").addClass("all")}}f("#poi-play-bar .repeat").on("click",function(){if(f(this).hasClass("once")){s=localStorage.repeat=2;f(this).removeClass("once").addClass("all")}else{if(f(this).hasClass("all")){s=localStorage.repeat=0;f(this).removeClass("all")}else{s=localStorage.repeat=1;f(this).addClass("once")}}});f("#poi-play-bar .shuffle").on("click",function(){if(f(this).hasClass("enable")){g=localStorage.shuffle="false";f(this).removeClass("enable")}else{g=localStorage.shuffle="true";f(this).addClass("enable")}});f("#poi-play-bar .poi-open-list,.poi-list-close").on("click",function(){if(f("#poi-music-list").hasClass("poi-music-list-c")){f("#poi-music-list").removeClass("poi-music-list-c").addClass("poi-music-list-o")}else{f("#poi-music-list").removeClass("poi-music-list-o").addClass("poi-music-list-c")}});f("#open-poi-player").on("click",function(){if(f("#poi-music-list").hasClass("poi-music-list-o")){f("#poi-music-list").removeClass("poi-music-list-o").addClass("poi-music-list-c")}if(f("#poi-play-bar").hasClass("poi-c")){f("#poi-play-bar").removeClass("poi-c").addClass("poi-o").css({"width":"100%"});f("#open-poi-player i").html("&#xe607;")
}else{f("#poi-play-bar").removeClass("poi-o").addClass("poi-c").css({"width":"30px"});f("#open-poi-player i").html("&#xe608;")}})})(jQuery);